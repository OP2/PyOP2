<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PyOP2 Architecture &#8212; PyOP2 2020.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=def86cc0" />
    
    <script src="_static/documentation_options.js?v=63d4e452"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PyOP2 Backends" href="backends.html" />
    <link rel="prev" title="The PyOP2 Intermediate Representation" href="ir.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="backends.html" title="PyOP2 Backends"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ir.html" title="The PyOP2 Intermediate Representation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyOP2 2020.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PyOP2 Architecture</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pyop2-architecture">
<span id="architecture"></span><h1>PyOP2 Architecture<a class="headerlink" href="#pyop2-architecture" title="Link to this heading">¶</a></h1>
<p>As described in <a class="reference internal" href="concepts.html#concepts"><span class="std std-ref">PyOP2 Concepts</span></a>, PyOP2 exposes an API that allows users to
declare the topology of unstructured meshes in the form of <code class="xref py py-class docutils literal notranslate"><span class="pre">Sets</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Maps</span></code> and data in the form of
<code class="xref py py-class docutils literal notranslate"><span class="pre">Dats</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Mats</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Globals</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Consts</span></code>. Computations on this data
are described by <code class="xref py py-class docutils literal notranslate"><span class="pre">Kernels</span></code> described in <a class="reference internal" href="kernels.html#kernels"><span class="std std-ref">PyOP2 Kernels</span></a>
and executed by <code class="xref py py-func docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">loops</span></code>.</p>
<p>The API is the frontend to the PyOP2 runtime compilation architecture, which
supports the generation and just-in-time (JIT) compilation of low-level code
for a range of backends described in <a class="reference internal" href="backends.html"><span class="doc">PyOP2 Backends</span></a> and the efficient
scheduling of parallel computations. A schematic overview of the PyOP2
architecture is given below:</p>
<figure class="align-center" id="id1">
<img alt="_images/pyop2_architecture.svg" src="_images/pyop2_architecture.svg" />
<figcaption>
<p><span class="caption-text">Schematic overview of the PyOP2 architecture</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>From an outside perspective, PyOP2 is a conventional Python library, with
performance critical library functions implemented in <a class="reference external" href="http://cython.org">Cython</a>. A user’s
application code makes calls to the PyOP2 API, most of which are conventional
library calls.  The exception are <code class="xref py py-func docutils literal notranslate"><span class="pre">par_loop()</span></code> calls, which
encapsulate PyOP2’s runtime core functionality performing backend-specific
code generation.  Executing a parallel loop comprises the following steps:</p>
<ol class="arabic simple">
<li><p>Compute a parallel execution plan, including information for efficient
staging of data and partitioning and colouring of the iteration set for
conflict-free parallel execution.  This process is described in <a class="reference internal" href="plan.html"><span class="doc">Parallel Execution Plan</span></a>
and does not apply to the sequential backend.</p></li>
<li><p>Generate backend-specific code for executing the computation for a given
set of <code class="xref py py-func docutils literal notranslate"><span class="pre">par_loop()</span></code> arguments as detailed in <a class="reference internal" href="backends.html"><span class="doc">PyOP2 Backends</span></a>
according to the execution plan computed in the previous step.</p></li>
<li><p>Pass the generated code to a backend-specific toolchain for just-in-time
compilation, producing a shared library callable as a Python module which
is dynamically loaded. This module is cached on disk to save recompilation
when the same <code class="xref py py-func docutils literal notranslate"><span class="pre">par_loop()</span></code> is called again for the same backend.</p></li>
<li><p>Build the backend-specific list of arguments to be passed to the generated
code, which may initiate host to device data transfer for the CUDA and
OpenCL backends.</p></li>
<li><p>Call into the generated module to perform the actual computation. For
distributed parallel computations this involves separate calls for the
regions owned by the current processor and the halo as described in
<a class="reference internal" href="mpi.html"><span class="doc">MPI</span></a>.</p></li>
<li><p>Perform any necessary reductions for <code class="xref py py-class docutils literal notranslate"><span class="pre">Globals</span></code>.</p></li>
<li><p>Call the backend-specific matrix assembly procedure on any
<code class="xref py py-class docutils literal notranslate"><span class="pre">Mat</span></code> arguments.</p></li>
</ol>
<section id="multiple-backend-support">
<span id="backend-support"></span><h2>Multiple Backend Support<a class="headerlink" href="#multiple-backend-support" title="Link to this heading">¶</a></h2>
<p>The backend is selected by passing the keyword argument <code class="docutils literal notranslate"><span class="pre">backend</span></code> to the
<code class="xref py py-func docutils literal notranslate"><span class="pre">init()</span></code> function.  If omitted, the <code class="docutils literal notranslate"><span class="pre">sequential</span></code> backend is
selected by default. This choice can be overridden by exporting the
environment variable <code class="docutils literal notranslate"><span class="pre">PYOP2_BACKEND</span></code>, which allows switching backends
without having to touch the code. Once chosen, the backend cannot be changed
for the duration of the running Python interpreter session.</p>
<p>PyOP2 provides a single API to the user, regardless of which backend the
computations are running on. All classes and functions that form the public
API defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyop2.op2</span></code> are interfaces, whose concrete implementations
are initialised according to the chosen backend. A metaclass takes care of
instantiating a backend-specific version of the requested class and setting
the corresponding docstrings such that this process is entirely transparent to
the user. The implementation of the PyOP2 backends is completely orthogonal to
the backend selection process and free to use established practices of
object-oriented design.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">PyOP2 Architecture</a><ul>
<li><a class="reference internal" href="#multiple-backend-support">Multiple Backend Support</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="ir.html"
                          title="previous chapter">The PyOP2 Intermediate Representation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="backends.html"
                          title="next chapter">PyOP2 Backends</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/architecture.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="backends.html" title="PyOP2 Backends"
             >next</a> |</li>
        <li class="right" >
          <a href="ir.html" title="The PyOP2 Intermediate Representation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyOP2 2020.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">PyOP2 Architecture</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2012-2013, Imperial College et al.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    </div>
  </body>
</html>